<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:fb="http://ogp.me/ns/fb#" lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta property="og:image" content="https://github.com/rmcarder/raleighparks/blob/master/raleighparks.PNG?raw=true" />
  <meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="Raleigh Parks" />
<meta name="twitter:title" content="Raleigh Parks" />
<meta name="twitter:description" content="Raleigh Parks" />
<meta name="twitter:image" content="https://github.com/rmcarder/fantasyfootball2016/blob/master/preview.PNG?raw=true" />
  <title>Raleigh Parks</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
  <link href='https://fonts.googleapis.com/css?family=Fjalla+One|Exo:400,600|Ropa+Sans' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=PT+Sans+Narrow|Arimo|Dosis|Lato' rel='stylesheet' type='text/css'>
 
</head>
<body>
<div class="header section">
  <div class="container">
    <h1 class="head">Raleigh Priority Parks</h1>
    <p class='head'>The Neighborhood and Community Connections Program is a $1 million effort to increase walkable connections between Raleigh’s neighborhoods and nearby parks and greenways.</p>
  </div>
<a href="https://github.com/rmcarder/raleighparks"><svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 250 250" fill="#383838" style="position: absolute; top: 0; right: 0">
  <path d="M0 0l115 115h15l12 27 108 108V0z" fill="#CECECE"/>
  <path class="octo-arm" d="M128 109c-15-9-9-19-9-19 3-7 2-11 2-11-1-7 3-2 3-2 4 5 2 11 2 11-3 10 5 15 9 16" style="-webkit-transform-origin: 130px 106px; transform-origin: 130px 106px"/>
  <path class="octo-body" d="M115 115s4 2 5 0l14-14c3-2 6-3 8-3-8-11-15-24 2-41 5-5 10-7 16-7 1-2 3-7 12-11 0 0 5 3 7 16 4 2 8 5 12 9s7 8 9 12c14 3 17 7 17 7-4 8-9 11-11 11 0 6-2 11-7 16-16 16-30 10-41 2 0 3-1 7-5 11l-12 11c-1 1 1 5 1 5z"/>
</svg></a>

</div>
<div class="controls section">
  <div class="container">
 
</div>
<div class="container-fluid">
    <div class="row">

        <div class="col-lg-6 col-md-6 col-sm-8 col-xs-12">
  <div style="text-align:center;">
       <!--    <div class="btn-group text-center" role="group" aria-label="Filter" style="text-align:center;">

    <button type="button" class="btn btn-primary" autofocus="true" id='top30'>Top 30</button>
    <button type="button" class="btn btn-primary" id='all'>All</button>
  </div> -->
            <div id="chart1"></div>
        </div>
      </div>
         <div class="col-lg-6 col-md-6" col-sm-4>
          <div style="text-align:center" class="legendtitle pv2"><strong class='whitespan'>Vulnerability </strong>- This measure is used to promote the N&CC Program’s goal of health equity, by targeting investment in pedestrian infrastructure in neighborhoods that would benefit most from increased walkability. Vulnerability scores are derived from socioeconomic and demographic indicators (Unemployment, Age Dependency, Educational Attainment, Housing Vacancy, and Poverty Rates) that correlate with high vulnerability to negative health outcomes.<br><strong class='whitespan'>Displayed on: Y-Axis </strong></div>

            <div style="text-align:center" class="legendtitle pv2"><strong class='whitespan'>Circuitry </strong>- This measure is used to identify areas of the city where street network topology is inefficient, and thus areas that could benefit from the addition of new links and nodes. Circuitry scores are calculated using distances between census blocks and park access points. A high circuitry score indicates that nearby residents have to travel a disproportionately long distance to reach their nearest park.<br><strong class='whitespan'>Displayed with: Circle Color </strong></div>
            <div id='circuitry'></div>
            <div style="text-align:center" class="legendtitle pv2"><strong class='whitespan'>Pedestrian Safety </strong>- This measure is used to identify park service areas that are particularly unsafe for pedestrians. Pedestrian Safety scores are derived from an analysis of street typology, speed limits, and the presence or absence of sidewalks within the park service area.<br><strong class='whitespan'>Displayed in: Mouseover Tooltip </strong></div>

            <div style="text-align:center" class="legendtitle pv2"><strong class='whitespan'>Population</strong>- The total number of people living within each park’s service area, which gives a sense of the potential number of people who could benefit from investments in each particular park.<br><strong class='whitespan'>Displayed with: Circle Size </strong></div>
            <div id='Population'></div>
            <div style="text-align:center" id="legend"></div>
            <div id="legend2"></div>
        </div>
        
    </div>
</div>  
</div>
<script type="text/javascript" src="https://npmcdn.com/d3@3.5.17/d3.min.js"></script>
<script type="text/javascript" src="https://npmcdn.com/science@1.9.3/science.v1.min.js"></script>
<script type="text/javascript" src="https://npmcdn.com/simple-statistics@2.0.0/dist/simple-statistics.min.js"></script>
<script type="text/javascript" src="https://npmcdn.com/d3-tip@0.6.7/index.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,600' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Fjalla+One|Exo:400,600|Ropa+Sans' rel='stylesheet' type='text/css'>
  <link href="https://fonts.googleapis.com/css?family=Exo" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Alegreya+Sans+SC" rel="stylesheet">
  <link href='https://fonts.googleapis.com/css?family=PT+Sans+Narrow|Arimo|Dosis|Lato' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="style.css">
        <link rel="stylesheet" type="text/css" href="tachyons.css">
<script>
  var data = [];
  var options = {
    all: 'no',
  };
  var margin = { top: 15, right: 60, bottom: 40, left: 70 };
  var width = parseInt(d3.select('#chart1').style('width'), 10)
  var width = width - margin.right - margin.left;
  var newXaxis=31;
  var aspectRatio = .75;
  var height = width*aspectRatio;
  var color_range = ['#eff3ff','#c6dbef','#9ecae1','#6baed6','#4292c6','#2171b5','#084594'];
  var data_bins = [10, 13, 16, 19, 22 ,25, 28];
     var rscale = d3.scale.sqrt()
      .domain([5000, 37000])
      .range([0,width/20]);

  
 // FETCH DATA
  d3.json('data.json', function (error, json) {
    if (error) { throw error; }    
    
    data = json;

      txdata=data.slice();
       gxdata = txdata.filter(function (d) {
           return d.Overall_Rank < 31;});


    



    var charts = [
       new Chart('#chart1',data, 'Overall_Rank', 'Priority Park Rank', 'VULNERABILITY_Score','Vulnerability',0,31,1,5)
     ];

 });

d3.select("#top30").classed('active',true);
  



  function Chart(selector, txdata, xvariable, xtitle, yvariable, ytitle, scaleMin, scaleMax, vulnMin, vulnMax) {    
    var chart = this;

    chart.xvariable = xvariable;
    chart.yvariable = yvariable;


    // SVG
    chart.svg = d3.select(selector)
      .append('svg')
      .attr('width', width + margin.right + margin.left)
      .attr('height', height + margin.top + margin.bottom)
      .append('g')
      .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');
  
    // SCALES 
    chart.x = d3.scale.linear()
      .domain([scaleMax, scaleMin])
      .range([0, width]);

    chart.y = d3.scale.linear()
      .domain([vulnMin, vulnMax])
      .range([height, 0])
      .nice();

 

    chart.colorScale = d3.scale.linear().domain(data_bins).range(color_range);


     

    // AXES
    chart.padding=0
    chart.axispadding=50
    chart.xaxispadding=35


    var ticks = [0,7.75,15.5,23.25,31,38.75,46.5,54.25,62,69.75,77.5,85.25,93,100.75,108.5,116.25,124];

    var tickLabels = ['','Higher Priority ->','','<- Lower Priority']


    chart.xAxis = d3.svg.axis()
      .tickSize(-height,0)
      .scale(chart.x)
      .orient("bottom")
      .tickValues(ticks)
      .tickFormat(function(d,i){ return tickLabels[i] });

    chart.yAxis = d3.svg.axis()
      .orient("left")
      .tickSize(-width)
      .scale(chart.y)
      .ticks(4,'0s');
    
    chart.gx = chart.svg.append("g")
      .attr("class","x axis")
      .attr("transform","translate(0,"+ height + ")")
      .call(chart.xAxis)
      ;

    chart.gy = chart.svg.append("g")
      .attr("class","y axis")
      .attr("transform","translate("+ chart.padding + ",0)")
      .call(chart.yAxis);
      ;

    chart.ytext=chart.svg.append("text")
      .attr("text-anchor", "middle")  // this makes it easy to centre the text as the transform is applied to the anchor
      .attr("class","axislabel")
      .attr("transform", "translate("+ (-chart.axispadding) +","+(height/2)+")rotate(-90)")  // text is drawn off the screen top left, move down and out and rotate
      .text(ytitle);

   chart.xtext = chart.svg.append("text")
      .attr("text-anchor", "middle")  // this makes it easy to centre the text as the transform is applied to the anchor
      .attr("class","axislabel")
      .attr("transform", "translate("+ (width/2) +","+(height+(chart.xaxispadding))+")")
      .text(xtitle);  // centre below axis
      
  chart.pointTooltip = d3.tip()
       .attr('class', 'tooltip')
       .offset([-6, 0])
       .html(function(d) { return d.SITE +'<br>' + "Overall Priority Rank: " + d[xvariable]+ '<br>'+ 'Population Benefiting: ' +d3.format(',')(d.SUM_POP) + ' (Rank: '+d.POPULATION_Rank +')'+ '<br> '+'Vulnerability Score: '+ (d3.format('.1f'))(d.VULNERABILITY_Score)+ ' (Rank: '+d.VULNERABILITY_Rank +')'+'<br> '+'Circuitry Score: ' +(d3.format('.1f'))((d.CIRCUITRY_Score)/10)+' (Rank: '+d.CIRCUITRY_Rank +')'+ '<br> '+'Pedestrian Safety Score: '+(d3.format('.1f'))(d.PED_SAFETY_Score) +' (Rank: '+d.PED_SAFETY_Rank +')'; });

     chart.pointTooltip(chart.svg);
 
   //  chart.update(txdata);

  var points = chart.svg.selectAll('.points')
      .data(gxdata);


    points.enter().append('circle')
       .attr('r',0)
       .style('opacity',.9)
       .on('mouseover', function(){
          d3.select(this).style("stroke",'#fff');
       })
       .on('mouseover', chart.pointTooltip.show)
       .on('mouseout', chart.pointTooltip.hide);


    points
    .transition().duration(3000).ease('elastic').delay(function(d, i) {
        return i / txdata.length * 700;  // Dynamic delay (i.e. each item delays a little longer)
        })
      .style('fill',function (d) { return chart.colorScale(d.CIRCUITRY_Score); })
      .attr('cx', function (d) { return chart.x(d[chart.xvariable]); })
      .attr('cy', function (d) { return chart.y(d[chart.yvariable]); })
      .attr('r', function (d) { return rscale(d.SUM_POP); });

    points
    .on("click", function(){
        d3.select(this).transition().duration(400).style("stroke",'#fff').style('stroke-width',3);
         })


d3.select(window).on('resize', resize); 


/*d3.select("#top30")
      .on("click", function(){
          options.all="no";
           gxdata = txdata.filter(function (d) {
           return d.Overall_Rank < 31;});
           console.log(gxdata);
           d3.select("#top30")
          .classed('active',true);
          d3.select("#all")
          .classed('active',false);
          newXaxis=31;
          rFactor=1;
          rescale();
        });

d3.select("#all")
      .on("click", function(){
          options.all='yes';
          gxdata = txdata.filter(function (d) {
           return d.Overall_Rank < 200;});
           console.log(gxdata);
           d3.select("#all")
          .classed('active',true);
          d3.select("#top30")
          .classed('active',false);
          newXaxis=131;
          rFactor=2;
          rescale();
        });
*/

    function rescale() {



    chart.x
        .domain([newXaxis,0]);

    chart.svg.selectAll('g.x.axis')
        .transition().duration(1500).ease("sin-in-out") 
        .call(chart.xAxis);

    points
      .transition().duration(1500).ease("sin-in-out") 
      .attr('cx', function (d) { return chart.x(d[chart.xvariable]); })
      .attr('cy', function (d) { return chart.y(d[chart.yvariable]); })
      .attr('r', function (d) { return rscale(d.SUM_POP)/rFactor; });






        }

  function resize() {
    // update width


    width = parseInt(d3.select('#chart1').style('width'), 10);
    width = width - margin.left - margin.right;
    height = width*aspectRatio;

chart.svg
      .attr('width', width + margin.right + margin.left)
      .attr('height', height + margin.top + margin.bottom);
    // resize the chart

    chart.x
      .range([0, width]);

    chart.y
      .range([height, 0]);


    rscale
      .range([0,width/20]);

    chart.xAxis
      .tickSize(-height,0)
      .scale(chart.x); 

    chart.yAxis
      .tickSize(-width)
      .scale(chart.y);
    
    chart.gx
      .attr("transform","translate(0,"+ height + ")")
      .call(chart.xAxis);

    chart.gy
      .attr("transform","translate("+ chart.padding + ",0)")
      .call(chart.yAxis);


    chart.ytext
      .attr("transform", "translate("+ (-chart.axispadding) +","+(height/2)+")rotate(-90)")  // text is drawn off the screen top left, move down and out and rotate
      .text(ytitle);

   chart.xtext
      .attr("transform", "translate("+ (width/2) +","+(height+(chart.xaxispadding))+")")
      .text(xtitle);  // centre below axis


    points
      .attr('cx', function (d) { return chart.x(d[chart.xvariable]); })
      .attr('cy', function (d) { return chart.y(d[chart.yvariable]); })
      .attr('r', function (d) { return rscale(d.SUM_POP); });
    


    //chart.update(txdata);
  
}





  }




  //Chart.prototype.update = function(txdata) {
  //var chart = this;



    
    
 
    // update median ticks
  //  var median = d3.median(chart.selectAll('.bar').data(), 
    //    function(d) { return d.percent; });



    // update axes
    //chart.select('.x.axis.top').call(xAxis.orient('top'));
   // chart.select('.x.axis.bottom').call(xAxis.orient('bottom'));

//}   
    

  
</script>
<script src="legend.js"></script>
</body>
</html>
